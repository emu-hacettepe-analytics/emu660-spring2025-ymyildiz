---
title:  <span style="color:brown;">INFLATION OF FOOD AND ITS EFFECT ON DIFFERENT EXPENDITURE GROUPS IN TURKEY</span> 
format:
  html:
    code-fold: true
    code-summary: "Show the code"
    code-copy: true
    embed-resources: true
---

## <span style="color:darkgreen;">1. Project Overview and Scope</span> 

Every country has an **inflation** which might be either positive or negative. It is stated that positive inflation points to a country's economic status regarding people's power to buy and maintain their lives. For the last few years, Turkey has been one of the countries that have suffered from high inflation. Moreover, inflation has been increasing day by day. The inflation word consists of many sub-categories some of which are food, cloth, education, and transportation consumer price index (CPI). This project mainly focuses on the ***CPI of food*** and its effect on various groups of ***people with different total expenditure levels***. To analyze the effect and infer, "Consumer price index (2003=100) according to main and sub-main groups, 2005-2025" and "Distribution of household consumption expenditure by quintiles ordered by expenditure, Türkiye, 2002-2023" data are driven from the website of TUIK, which is short for Turkey Statistics Institute.

## <span style="color:darkgreen;">2. Data</span> 

```{r, message=FALSE}
#install.packages("readxl")
library(readxl)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(simplermarkdown)
consumer_price_index_data <- read_xlsx((path = "consumer_price_index_according_to_groups.xlsx"), .name_repair = "unique_quiet")
comparison_of_consumption_types <- read_xlsx(path = "comparison_of_consumption_types_according_to_expenditure.xlsx")
```


### <span style="color:green;">2.1 General Information About Data</span>

The data files used for in-depth analysis are driven from the TUIK website. The data named **"Distribution of household consumption expenditure by quintiles ordered by expenditure, Türkiye, 2002-2023"** consists of the distribution of consumption expenditure types of different expenditure groups. This data is also referred to as *"comparison_of_consumption_types"* and *"COCT data"* throughout the project. There are 5 groups in the columns named "First quantile", "Second quantile", "Third quantile", "Fourth quantile", and "Last quantile". Each represents 20% of the people who are subject of the data research in an ascending order of expenditure amount. Namely, the First quantile represents the %20 of the people who spend the least while the Last quantile represents the people who spend the most. There are different expenditure types for the years in the rows. However, there is no data from the years 2020 and 2021 even though the data is named by 2002-2023. Besides, there are two types of expenditure categorization for 2022 with a slight difference in splitting one type into two types. This update of categorization continues in 2023 as well. Consequently, there are 12 different expenditure types for the each year from 2002 to 2022, excluding 2020 and 2021,  while there are 14 for the years 2022 and 2023. \

Another data used is named **"Consumer price index (2003=100) according to main and sub-main groups, 2005-2025"**, which is also referred to as *"consumer_price_index_data"* and *"CPI data"* throughout the project. This data shows the consumer price index value of 288 different main and sub-groups of expenditure according to each month of the years from 2005 to 2025. Year and month information is on the rows while the group names form the columns.  Only the columns directly related to food are considered as the scope of this project. \

The same years are considered to analyze the relation between CPI of food and its effect on different group of people with different levels of expenditure. Thus, the years between 2005-2023 for both of the data sets are selected as the interval of the project.

### <span style="color:green;">2.2 Reason of Choice</span>

The inflation of a country tells a lot about its economic status. It tells so many things that the food aspect of it might be underestimated. Nevertheless, reaching food has been one of the major concerns of mankind. Over the decades, this concern has become more crucial for Turkish people, especially having low levels of income and belonging to the first and second quantile of expenditure level groups. The data chosen for this project helps us to understand which group of people spend what percentage of their money on food and how this rate changes according to the inflation and consumer index of food. The conclusion of the project might shed light on the facts like a sign of socioeconomic differences among Turkish people. It might also enable society to comprehend the situation of access to quality food according to different expenditure groups.

### <span style="color:green;">2.3 Preprocessing</span>

To begin with, the raw data which are in Excel (.xlsx) format driven from the website of TUIK are browsed as they are. Some of the rows and columns are deleted since they include texts providing information about the data. Later, Turkish headings are removed from each row and column in the files. After a few operations in the Excel format of the files, they become ready to be imported to R. Both data are also saved in RData format to be processed in R. \

Having completed the format operations, it is observed that COCT data frame has 243 rows and 291 columns while CPI data frame has 275 row and 8 columns.

```{r}
save(consumer_price_index_data, file = "consumer_price_index_data.RData")
save(comparison_of_consumption_types, file = "comparison_of_consumption_types.RData")
load("consumer_price_index_data.RData")
load("comparison_of_consumption_types.RData")
```

```{r}
nrow_CPI <- nrow(consumer_price_index_data)
ncol_CPI <- ncol(consumer_price_index_data)
nrow_COCT <- nrow(comparison_of_consumption_types)
ncol_COCT <- ncol(comparison_of_consumption_types)
summary_of_number_of_row_and_columns <- data.frame(
data_set_name = c("consumer_price_index_data","comparison_of_consumption_types"),
number_of_rows = c(nrow_CPI, nrow_COCT),
number_of_columns = c(ncol_CPI, ncol_COCT)
)
knitr::kable(summary_of_number_of_row_and_columns, caption = "Table 1: Dimensions of the Unprocessed Data")
```

[Downloadable COCT Data in .RData version](https://github.com/emu-hacettepe-analytics/emu660-spring2025-ymyildiz/raw/refs/heads/main/comparison_of_consumption_types.RData) \

[Downloadable CPI Data in .RData version](https://github.com/emu-hacettepe-analytics/emu660-spring2025-ymyildiz/raw/refs/heads/main/consumer_price_index_data.RData) \

#### <span style="color:green;">2.3.1 Comparison of Consumption Types (COCT) Data</span>

In the data, columnn names include space (" ") which is not user-friendly in R. Therefore all the spaces is replaced by "_" sign. On the row side, it is observed that a few years are shown with an additional information for some of the years. For instance, year 2007 is represented as "2007(1)". The reason there are additional value like "(1)" or "(2)" for some of the years is that there is a note about the background of data gathered from those years with the same sign in the very below of the page, which is basically a footnote. In short, all the year value in the first row arranged so that all have only 4 digits. The rows with total consumption expenditure information is also removed since they only have 100% value. Moreover, only the rows having food and non-alcoholic beverages expenditure are kept. \ 

As mentioned in the beginning of General Information About the Data chapter, there are two rows belonging to year 2022 in the data at this point. 2 rows belonging to 2022 is reduced to one row by taking their average. This turned out to be the most complex operation among the ones done in R so far. Finally, the class of Year column is turned into numeric from character and only years between 2005-2023.\

The final look of the data after the operations is as shown below:

```{r}
comparison_of_consumption_types <- comparison_of_consumption_types %>% 
  rename_with(~ gsub(" ","_", .x), contains(" ")) %>% #removing the space " " from the columns and replacing them with "_"
  mutate(Year = substr(Year, 1, 4)) %>% #rearranging the Year column
  filter(Total!=100) %>% #removing the rows having total consumption expenditure information 
  filter(Expenditure_Types=="Food and non-alcoholic beverages")

#comparison_of_consumption_types_v1 <- comparison_of_consumption_types %>%
#  mutate(Year_Expenditure_Type = paste(Year, Expenditure_Types, sep="_")) #mutating a new column including year and expenditure type
#There is year and expenditure type information for each row. Another column is mutated including year and expenditure type at the same time. There can be unique information column for each row thanks to this operation. This operation is used in the later of this project even though there is no need to such operation. Because we have only one row for each year after removing the unnecessary expenditure types.


#Rearranging Year 2022 Columns
rows_to_merge <- c(19, 20) #the indexes of the rows with year 2022
merged_rows <- comparison_of_consumption_types[rows_to_merge, ] #selecting year 2022 rows
new_row <- comparison_of_consumption_types[1, ]  # starting to a new data frame

for (col in names(comparison_of_consumption_types)) { #creating a loop 
  if (is.numeric(comparison_of_consumption_types[[col]])) {
    new_row[[col]] <- mean(merged_rows[[col]], na.rm = TRUE)
  } else if (is.character(comparison_of_consumption_types[[col]]) || is.factor(comparison_of_consumption_types[[col]])) {
    values <- unique(as.character(merged_rows[[col]]))
    if (length(values) == 1) {
      new_row[[col]] <- values
    } else {
      new_row[[col]] <- NA
    }
  } else {
    new_row[[col]] <- NA
  }
}

comparison_of_consumption_types_updated <- comparison_of_consumption_types[-rows_to_merge, ] #deleting the initial two 2022 rows

new_position <- nrow(comparison_of_consumption_types_updated)  # position of the generated row

#rearranging the position of the generated row
COCT_final <- bind_rows(
  comparison_of_consumption_types_updated[1:(new_position - 1), ],
  new_row,
  comparison_of_consumption_types_updated[new_position:nrow(comparison_of_consumption_types_updated), ]
)

COCT_final$Year <- as.numeric(COCT_final$Year) #changing the class of Year column to numeric

COCT_final <- subset(COCT_final[, -2:-3], Year>=2005) #selecting the years starting from 2005

knitr::kable(COCT_final, caption = "Table 2: Change of Food Expenditure Percentage According to Quintiles by Years")
```

#### <span style="color:green;">2.3.2 Consumer Price Index (CPI) Data</span>

As an initial sense, there are too many columns as groups of expenditure some of which are not the topic of this project. These columns are removed from the data. However, it is not that easy to obtain all the columns containing food information. After conducting an operation where the aim is selecting the columns containing "food" word, it is observed that there are columns named like "Fish and seafood" and "Other food products...". What we can deduce is that there might be much more columns related to food than the ones containing "food" word. After a few try, the data appeared to have so many columns including food information like meat, chicken, bread etc. \

On the row side, there is year and month information. An additional row for each year is mutated as the average value of the months of a year. Thanks to this operation, CPI value of food and how it changes can be evaluated not only by months but also by the years. The month column and its relative rows is kept for further analysis.\

The final look of the data after the operations is as shown below:

```{r, warning=FALSE}
#Generating rows containing average CPI value of each year
consumer_price_index_yearly <- consumer_price_index_data %>%
  group_by(Year) %>%
  summarise(across(where(is.numeric), mean, na.rm = TRUE)) %>%
  mutate(Months = "Average") %>%
  select(Year, Months, everything()) %>%
  subset(Year<=2023)
  
#head(consumer_price_index_data)

consumer_price_index_food <- consumer_price_index_yearly %>% select(Year | Months | General | contains("food")) #selecting the columns related to food

COCT_final$Year <- as.numeric(COCT_final$Year)
CPI_food_final <- consumer_price_index_food[, c(1,4)]
CPI_food_final <- rename(CPI_food_final, "CPI_of_food"="Food and non-alcoholic beverages")

knitr::kable(CPI_food_final, caption = "Table 3: Change of Food CPI by Years", align="l")
#consumer_price_index_data <- bind_rows(consumer_price_index_data, consumer_price_index_yearly)
```

## <span style="color:darkgreen;">3. Analysis</span>

The analysis part of the project will consist of... There will be plots mainly comparing the CPI of years and months within the years, and comparing food expenditure rates relative to the food CPI values.   

### 3.1 Exploratory Data Analysis

After intense preprocessing phase, to look at the graphical reflection of the updated data isa good start for analysis. Initial plotting is done separately to have general understanding of what the data say. \

```{r, warning=FALSE}
COCT_long <- COCT_final %>%
  pivot_longer(cols = -Year,
               names_to = "category",
               values_to = "value")

ggplot(COCT_long, aes(x = Year, y = value, color = category, group = category)) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  xlab("Year") +
  ylab("Food Expenditure Percentage of Quintiles") +
  ggtitle("Graph 1: Food Expenditure Percentage by Expenditure Groups Over the Years") +
  theme_minimal()
```

As a general conjecture, people with the lowest income level naturally are the ones who spent the least. According to the initial observations people who spent very less spend at least one third of their money to food. 

```{r}
consumer_price_index_food %>% 
  filter(Months=="Average") %>%
  ggplot(aes(Year, `Food and non-alcoholic beverages`)) + geom_line(color="pink", linewidth=2) +
  xlab("Year") +
  ylab("Food CPI") +
  ggtitle("Change in Food CPI Over the Years") +
  theme_minimal()
```


### 3.2 Trend Analysis
```{r}
merged_data <- left_join(COCT_final, CPI_food_final, by = "Year") #merging two processed data

model_A <- lm(First_quintile ~ CPI_of_food, data = merged_data)
summary(model_A)

results <- lapply(names(merged_data)[2:6], function(grup) {
  form <- as.formula(paste(grup, "~ CPI_of_food"))
  model <- lm(form, data = merged_data)
  summary(model)
})
names(results) <- names(merged_data)[2:6]

diff(log(CPI_food_final$CPI_of_food))

library(cluster)

library(factoextra)
k_data <- COCT_final %>% select(-Year)
k_clusters <- kmeans(k_data, centers = 3)
fviz_cluster(k_clusters, data = k_data)

model_A <- lm(First_quintile ~ CPI_of_food, data = merged_data)
predict(model_A, newdata = data.frame(CPI_of_food = 160))
```


### 3.3 Model Fitting


### 3.4 Results


## 4. Results and Key Takeaways

